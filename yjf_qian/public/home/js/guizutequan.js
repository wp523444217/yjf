function formatNumber(e){e+="";for(var a=/(-?\d+)(\d{3})/;a.test(e);)e=e.replace(a,"$1,$2");return e}function formatCurrency(e){e=e.toString().replace(/\$|\,/g,""),isNaN(e)&&(e="0"),sign=e==(e=Math.abs(e)),e=Math.floor(100*e+.50000000001),cents=e%100,e=Math.floor(e/100).toString(),10>cents&&(cents="0"+cents);for(var a=0;a<Math.floor((e.length-(1+a))/3);a++)e=e.substring(0,e.length-(4*a+3))+","+e.substring(e.length-(4*a+3));return(sign?"":"-")+e+"."+cents}function milliSecondToDate(e,a){var t=new Date(e),o=t.getFullYear(),n=t.getMonth()+1;n=9>n?"0"+n:n;var i=t.getDate();return i=9>i?"0"+i:i,o+a+n+a+i}function renewConfirm(){confirmRenewPopbox.open(),renewPopbox.close(),$("#confirmRenewPopbox").css("height","250"),nobleUtil.doVerifyActCodeByCaptcha()}function setTimeValue(e){if(e=Math.abs(parseInt(e)),isNaN(e)||0==e)return $("#timeErrorInfo").css("display","inline"),void $("#renewConfirmBtn").off("click").css({background:"#FBDEB2",cursor:"no-drop"});$("#timeErrorInfo").hide(),$("#renewConfirmBtn").off("click").on("click",renewConfirm).css({background:"#f80",cursor:"pointer"}),$("#otherMonthsInput").val(e),e>6&&$("#otherMonthsInput").val(6);var a=moment(nobleUtil.validDate);e>6&&(e=6),nobleUtil.renewMonth=e;var t=nobleUtil.nobleLevel,o=0,n=0;switch(t){case 1:o=10,n=10.4;break;case 2:o=50,n=52;break;case 3:o=200,n=210;break;case 4:o=1200,n=1300;break;case 5:o=3e3,n=3250;break;case 6:o=3e4,n=33e3}var i=formatNumber(e*o);$("#payYbInput").val(i),$(".payYb").html($("#payYbInput").val()),$("#needYb").html(i);var r=formatNumber(e*n*1e4/1e4);$("#returnYbGoldBean").html(r);var l=moment(new Date),s=(a.diff(l,"days"),moment().add(720,"days"));if(a.isAfter(s))$("#newValidDate").html(a.format("YYYY-MM-DD"));else{var d=a.add(30*e,"days");$("#newValidDate").html(d.isAfter(s)?l.add(720,"days").format("YYYY-MM-DD"):d.format("YYYY-MM-DD"))}}function showNoble(e){var a;a?a.show(!0):$.getScript("http://a.dwstatic.com/huya/icenter/2.5/js/createLayer.js",function(){var t=Math.floor(1e10*Math.random());a=new Createlayer({title:"贵族续费",width:740,height:540,url:"http://hd.huya.com/gzopen/reChargeLayer.html?anchorUid="+e+"&channelId=0&subChannelId=0&source=icenter",idDom:"topUpPaymentLayer_"+t,idMask:"topUpPaymentLayerMask_"+t})})}var dataType="jsonp",getDataHost="http://q.huya.com/yy/";"undefined"!=typeof embedYyUrl&&embedYyUrl.length>0&&(getDataHost=embedYyUrl);var nobleUtil={maxYb:1e3,pageSize:6,nobleType:0,nobleLevel:0,validDate:0,imgUrl:"",smallImgUrl:"",time:"",sign:"",currentYb:0,renewMonth:0,totalPage:0,init:function(){this.getNobleInfo(),$("#openServiceSort").on("click",nobleUtil.sortPresent),$("#validDateSort").on("click",nobleUtil.sortPresent)},getNobleInfo:function(){$.ajax({url:getDataHost+"index.php?m=Noble&do=getTimeSign",dataType:dataType,success:function(e){if(200==e.status){var a=e.data.time,t=e.data.sign;nobleUtil.time=a,nobleUtil.sign=t,$.ajax({url:getDataHost+"index.php?m=Noble&do=getNobleInfo",data:{time:a,sign:t,anchorUid:"123"},dataType:dataType,success:function(e){var a=e.data;if(200==e.status)if(a.isNoble){$("#nobleInfo").show(),$("#kong").hide();var t=a.nobleInfo.nobleName;nobleUtil.nobleName=t,$("#nobleName").html(t);var o,n,i,r="http://assets.dwstatic.com/project/yytv/center/2.9.1/img/",l="http://assets.dwstatic.com/project/yytv/center/2.9.1/img/";switch(a.nobleInfo.nobleLevel){case 1:r+="guizu-jian.png",l+="guizu-jian-x.png",o=formatNumber(10),n=formatNumber(40),i=formatNumber(10.4);break;case 2:$("#nobleName").css("color","#04721a"),r+="guizu-qi.png",l+="guizu-qi-x.png",o=formatNumber(50),n=formatNumber(250),i=formatNumber(21);break;case 3:$("#nobleName").css("color","#1787cf"),r+="guizu-ling.png",l+="guizu-ling-x.png",o=formatNumber(200),n=formatNumber(800),i=formatNumber(210);break;case 4:$("#nobleName").addClass("jue"),r+="guizu-jue.png",l+="guizu-jue-x.png",o=formatNumber(1200),n=formatNumber(3800),i=formatNumber(1300);break;case 5:$("#nobleName").addClass("jun"),r+="guizu-jun.png",l+="guizu-jun-x.png",o=formatNumber(3e3),n=formatNumber(12e3),i=formatNumber(3250);break;case 6:$("#nobleName").addClass("di"),r+="guizu-di.png",l+="guizu-di-x.png",o=formatNumber(3e4),n=formatNumber(12e4),i=formatNumber(33e3)}$("#onlyNeedYb").text(o),$("#saveYb").text(n),$("#rebackYb").text(i),nobleUtil.nobleLevel=a.nobleInfo.nobleLevel,$("#biaoji_tu").html("<img src='"+r+"'>"),nobleUtil.imgUrl=r,nobleUtil.smallImgUrl=l;var s=1e3*parseInt(a.nobleInfo.validDate),d=milliSecondToDate(s,"-");nobleUtil.validDate=s,$("#validDate").html(d),nobleUtil.nobleType=a.nobleInfo.nobleType;{a.nobleInfo.pid}}else $("#kong").show()}})}}})},prevAndNext:function(e){var a=$("#presentNobleTablePage").find(".current"),t=a.data("pageindex");"prev"==e?((5==t||(t-5)%4==0)&&(nobleUtil.startPage=t-4),t-=1):t+=1,1>t&&(t=1),t>nobleUtil.totalPage&&(t=nobleUtil.totalPage)},startPage:1,sortPresent:function(){var e,a,t=$(this).data("sort"),o=($(this).data("type"),"desc");switch(t){case 0:e="arrow arrow-up",a=1,o="asc";break;case 1:e="arrow arrow-down",a=-1,o="desc";break;case-1:e="arrow",a=0,o="desc"}$(this).find("span").removeClass().addClass(e),$(this).data("sort",a)},doVerifyActCodeByCaptcha:function(){$("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$.ajax({url:getDataHost+"index.php?m=Noble&do=getTimeSign",dataType:dataType,success:function(e){if(200==e.status){var a=e.data.time,t=e.data.sign;nobleUtil.time=a,nobleUtil.sign=t,$.ajax({url:getDataHost+"index.php?m=Noble&do=doVerifyActCodeByCaptcha",data:{anchorUid:"123",channelId:"0",subChannelId:"0",type:2,nobleLevel:nobleUtil.nobleLevel,time:nobleUtil.time,sign:nobleUtil.sign},dataType:dataType,success:function(e){200==e.status&&(nobleUtil.orderId=e.data.orderId,nobleUtil.time=e.data.time,nobleUtil.sign=e.data.sign,nobleUtil.getYbNum())}})}}})},getYbNum:function(){var e=this;$.ajax({url:getDataHost+"index.php?m=Noble&do=getYbNum",data:{anchorUid:"123",channelId:"0",subChannelId:"0",orderId:nobleUtil.orderId,time:nobleUtil.time,sign:nobleUtil.sign},dataType:dataType,success:function(a){if(200==a.status){var t=parseInt($("#payYbInput").val().replace(",",""));if(nobleUtil.currentYb=a.data,t>nobleUtil.maxYb)return void nobleUtil.getUserMobileInfo();if(a.data<t){$("#notEnoughtYb").removeClass("hide"),$("#currentYb").html(a.data);var o=Math.ceil(t-a.data);$("#payNeedYb").html(o)}else e.buyNobleByCaptcha()}}})},checkRecharge:function(){$("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#loadingRecharge").removeClass("hide");var e=!1,a=setInterval(function(){$.ajax({url:getDataHost+"index.php?m=Noble&do=getYbNum",data:{anchorUid:"123",channelId:"0",subChannelId:"0",orderId:nobleUtil.orderId,time:nobleUtil.time,sign:nobleUtil.sign},dataType:dataType,success:function(t){if(200==t.status){var o=parseInt($("#payYbInput").val().replace(",",""));t.data>o&&(o>nobleUtil.maxYb&&nobleUtil.getUserMobileInfo(),$("#loadingRecharge").addClass("hide"),clearInterval(a),e=!0)}}})},5e3);setTimeout(function(){if(!e){clearInterval(a),$("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#rechargeError").removeClass("hide"),$("#currentYb2").html(nobleUtil.currentYb);var t=parseInt($("#payYbInput").val().replace(",","")),o=Math.ceil(t-nobleUtil.currentYb);$("#payNeedYb2").html(o)}},9e5)},buyNobleByCaptcha:function(){$.ajax({url:getDataHost+"index.php?m=Noble&do=buyNobleByCaptcha",dataType:dataType,data:{captcha:$.trim($("#captchaInput").val()),channelId:"0",subChannelId:"0",orderId:nobleUtil.orderId,anchorUid:"123",type:2,level:nobleUtil.nobleLevel,activationCode:"0",renewMonth:nobleUtil.renewMonth,time:nobleUtil.time,sign:nobleUtil.sign},success:function(e){if(200==e.status)nobleUtil.queryPayResult();else if(510==e.status){var a=e.data.jsondata.info;-30==e.data.jsondata.code&&(confirmRenewPopbox.close(),pay.JsLoader.loadAuthDivForUrl(a,"yb_util.payMoneyCallbackJs"),$("#validMobileErrorInfo").html(e.msg))}else $("#validMobileErrorInfo").html(e.msg)}})},retryCount:1,queryPayResult:function(){$("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#loadingPayResult").removeClass("hide");var e=!0;$.ajax({url:getDataHost+"index.php?m=Noble&do=queryPayResult",dataType:dataType,data:{anchorUid:"123",channelId:"0",subChannelId:"0",orderId:nobleUtil.orderId,time:nobleUtil.time,sign:nobleUtil.sign},success:function(a){return 200==a.status?($("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#successPay").removeClass("hide"),void $("#rebackGold").html(formatNumber(a.data.rebackGold/1e3))):(504==a.status?msg="恭喜你，订单处理成功":(nobleUtil.retryCount++,nobleUtil.retryCount<5?(e=!0,$("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#loadingPayResult").removeClass("hide"),setTimeout(function(){nobleUtil.queryPayResult()},1e3)):msg=a.msg),void(0==e&&($("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),$("#errorPay").removeClass("hide"),$("#errorPayInfo").text(msg),nobleUtil.retryCount=5)))}})},sendCaptcha:function(){$.ajax({url:getDataHost+"index.php?m=Noble&do=sendCaptcha",dataType:dataType,success:function(e){if(200==e.status){$("#sendCaptchaInfo").html("重新获取(60)").css("display","inline"),$("#sendCaptchaBtn").css("display","none");var a=60,t=setInterval(function(){a--,1>a&&(clearInterval(t),$("#sendCaptchaBtn").css("display","inline"),$("#sendCaptchaInfo").css("display","none"),$("#validMobileErrorInfo").css("display","none")),$("#sendCaptchaInfo").html("重新获取("+a+")")},1e3)}else $("#sendCaptchaInfo").css("display","none"),$("#validMobileErrorInfo").html(e.msg).css("display","inline")}})},getUserMobileInfo:function(){$.ajax({url:getDataHost+"index.php?m=Noble&do=getUserMobileInfo",dataType:dataType,success:function(e){200==e.status&&($("#confirmRenewPopbox").find(".box-bd").removeClass("hide").addClass("hide"),e.data.isBind?($("#validMobile").removeClass("hide"),$("#phone_number").html("<a href='https://aq.yy.com/mb/mob/index.do' target='_blank'>"+e.data.bindMobile+"</a>")):$("#bindUserMobile").removeClass("hide"))}})}};nobleUtil.init();var renewTimeValue=0,confirmRenewPopbox=LEGO.popupBox("#confirmRenewPopbox",{ok:function(){confirmRenewPopbox.close()},cancle:function(){confirmRenewPopbox.close()},existMask:!1});$("#renewConfirmBtn").off("click").on("click",renewConfirm);var renewPopbox=LEGO.popupBox("#renewPopbox",{ok:function(){renewPopbox.close()},cancle:function(){renewPopbox.close()},existMask:!1});$("#renewBtn").on("click",function(){var e=$(this).data("uid");showNoble(e)}),$("#otherMonths").on("click",function(){$("#otherMonthsInput").focus()}),$("#otherMonthsInput").on("click",function(){$("#otherMonths").attr("checked",!0),setTimeValue(0)});